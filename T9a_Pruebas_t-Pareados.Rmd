---
title: "T9a_Pruebas_t-Pareados"
output: 
  html_document:
    toc: yes
    toc_float: yes
    css: custom.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message = FALSE)

```

```{r, echo=FALSE}
library(tidyverse)

rlt_theme <- theme(axis.title.y = element_text(colour="grey20",size=15,face="bold"),
        axis.text.x = element_text(colour="grey20",size=10, face="bold"),
        axis.text.y = element_text(colour="grey20",size=15,face="bold"),  
        axis.title.x = element_text(colour="grey20",size=15,face="bold"))+
  theme(
  # Remove panel border
  panel.border = element_blank(),  
  # Remove panel grid lines
  panel.grid.major = element_blank(),
  panel.grid.minor = element_blank(),
  # Remove panel background
  panel.background = element_blank(),
  # add thicker border lines
    axis.line.x = element_line(colour = "black", size = 1),
    axis.line.y = element_line(colour = "black", size = 1)
  )

# The palette with grey:
cbPalette1 <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

# The palette with black:
cbPalette2 <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

# To use for fills, add
#  scale_fill_manual(values=cbPalette)

# To use for line and point colors, add
  #scale_colour_manual(values=cbPalette)

```


```{r, eval=TRUE, echo=FALSE}
colorize <- function(x, color) {
  if (knitr::is_latex_output()) {
    sprintf("\\textcolor{%s}{%s}", color, x)
  } else if (knitr::is_html_output()) {
    sprintf("<span style='color: %s;'>%s</span>", color, 
      x)
  } else x
}

#`r colorize("some words in red", "red")`


```

Fecha de la ultima revisión
```{r, echo=FALSE}

Sys.Date()
```

# Prueba de t-pareado

Si tienes datos que no son independiente, es necesario usar la prueba con datos pareados (paired t-test). Cuando se refiere a datos no independiente es que hay evidencia que los datos pueden estar relacionado de una forma. En el siguiente ejemplo tenemos la altura de los padres y el altura de el hijo.  Hay evidencia que genética influencia la altura de los humanos, también hay el ambiente.  Si el ambiente (nutrición, etc) es la única variable que tiene influencia sobre la altura pudiese que no encontramos una relación entre la altura del padre y el hijo.

Los datos provienen del paquete **UsingR** y el archivo se llama **father.son**




Paired Two-Sample T-test


```{r, data}

require(Hmisc)
require(UsingR)
head(father.son)

```
***
## Visualizar la diferencias

Antes de hacer la prueba es recomendado hacer un gráfico de puntos para visualizar los datos y observar si hay un patrón. Vemos a medida que aumenta la altura de los padres los hijos tienden a estar más altos.  


```{r, geompoint}


ggplot(father.son, aes(fheight, sheight))+
  geom_point()+
  rlt_theme
```
***

La prueba de t-con datos pareados es la misma que la prueba de t con un grupo, **t.test()**.  

Las opciones para esta prueba son las siguientes en roja

  + t.test(`r colorize("x", "red")`, `r colorize("y", "red")`,
    + `r colorize("alternative = c(two.sided, less, greater)", "red")`,
    +  mu =, `r colorize("paired = FALSE", "red")`, var.equal = FALSE,
    +  `r colorize("conf.level = 0.95", "red")`, ...).

El resultado:  El valor de t-observado es de 11.789, con un grado de libertad de 1077 (n=1078), y valor de p <0.0001. Por consecuencia se rechaza la hipótesis nula y se acepta la alterna.  El intervalo de confianza del promedio es -1.163 a -0.831, con un promedio de -0.99. Esto significa que los padres tiende a estar una pulgada (-0.99) más bajo que los hijos. 

```{r, pairttest}
t.test(father.son$fheight, father.son$sheight, paired=TRUE)
```

***
## Visualizar la diferencias
Podemos visualizar la diferencia entre los hijos y los padres, vemos el promedio si no tuviese diferencis (la linea azul), y el estimado (el promedio de la diferencias es rojo, con el intervalo de confianza en las lineas entrecortada).  
```{r graph2}
heightDiff<-father.son$fheight-father.son$sheight # para calcular la diferencia entre el padre y el hijo. 
ggplot(father.son, aes(x=fheight-sheight))+
  geom_density()+
  geom_vline(xintercept = mean(heightDiff), colour="red")+
  geom_vline(xintercept = mean(heightDiff)+ 2*c(-1,1)*sd(heightDiff)/sqrt(nrow(father.son)), linetype=2)+
  geom_vline(xintercept = 0, colour="blue")+
  rlt_theme+
  xlab("Diferencia en altura entre padres y hijos")
```
***

# Paired t-test, Números de niños abuela y madre
 

Ver si la cantidad de hijos cambia entre su abuela y su madre
```{r, abuelamadre}
abuela=c(3,11,3,9,3,3,3,
         4,3,7,6,7,6,3,2,4)
madre=c(2,3,3,3,1,2,2,
        2,2,2,2,1,3,2,2,2)
df=data.frame(abuela,madre)
df
df$diff=df$abuela-df$madre
df

mean(df$diff)

t.test(df$abuela,df$madre, paired=TRUE)

```





# Cultivador de Toronjas con parcelas pareadas

Un cultivador heredo parcelas donde hay árboles de toronjas.  El quiere saber si al añadir abono, la cosecha de toronjas aumenta.  El efecto del abono sobre la producción de toronjas en parcelas pareadas en Puerto Rico. 

La cantidad de Toronjas producidas por árbol en fincas pareadas, cada finca tiene una parcela con abono y la otra la otra parcela sin abono. Tenemos 18 diferentes sitios en PR donde se probo el efecto del abono sobre la producción de toronjas, se enseña solamente lo primero 8 pares de valores en la tabla.  

```{r, toronja}
library(tibble)
Toronja=tribble(
  ~Fertilizante, ~Sin_Fertilizante, ~Municipio,
  "2250"		,		"1920" , "Utuado",
 "2410",				"2020",  "Cabo Rojo",
 "2260",				"2060",  "Manati",
 "2200",	 			"1960",  "Yabucoa",		
 "2360",				"1960", "Humacao", 
 "2320",				"2140","Caguas",
 "2240",				"1980", "San Juan",
 "2300",				"1940", "Jayuya",
 "2090",				"1790","Ponce"
)
library(huxtable)
huxtable(Toronja)%>%
    theme_article(header_col = FALSE)%>%
  set_bottom_border(row = 1, col = everywhere, value = 1) %>% 
  set_caption("La cantidad de toronjas producidas en parceles en diferentes municipios")%>%
  add_footnote("Cada parcela es del mismo tamaño con la misma cantidad de arboles")
```
1. Primero añademos los datos en listas y la unimos en un df.  
2. Se calcula la diferencias de producción de toronjas por parcela
3. Cual es el promedio de las diferencias
4. La prueba de t con datos pareado.

El resultado:  El valor de t-observado es de 8.80, con un grado de libertad de 17 (n=18), y valor de p <0.0001. Por consecuencia se rechaza la hipótesis nula y se acepta la alterna.  El intervalo de confianza del promedio es 198.5 - 323.7, con un promedio de 261. Esto significa que a añadir fertilizante la producción de toronjas aumento de en promedio de 261 toronjas.

```{r, dftoronja}
Fert=c(2250,2410, 2260,2200, 2360, 
     2320,2240,2300,2090, 2250,2410, 2260,2200, 2360, 
     2320,2240,2300,2090)
#Fert
SFert=c(1920,2020,2060,1960,
     1960,2140,1980,1940,2100, 1920,2020,2060,1960,
     1960,2140,1980,1940,2100)
#SFert
df=data.frame(Fert,SFert)
df$diff_produccion=df$Fert-df$SFert 

mean(df$diff_produccion) # el promedio de las diferencias


t.test(df$Fert,df$SFert, paired=TRUE)
```




# El número de Hojas por planta en diferentes momentos (tiempo)


Los datos representa cuantas hojas tenian las plantas en diferentes momentos de su muestreo.  Por consecuencia los datos nos son independiente. 


```{r, datosLep}
library(readr)
Lepanthes_eltoroensis_Georges_STUDENT <- read_csv("Data_files_csv/Lepanthes_eltoroensis_Georges_STUDENT.csv")

Lep=Lepanthes_eltoroensis_Georges_STUDENT
head(Lep)

length(Lep$T1)
```


```{r look at the data}
head(Lep)
length(Lep$T11)
```



```{r paired t-test}
tail(Lep)


model2=t.test(Lep$T3,Lep$T1, paired =TRUE)
model2
```

# Cual son los supuestos de la prueba de t con datos pareados
## El supuesto es que la diferencia entre los valores de los dos grupos tiene una distribución normal.

#### `r colorize("Hay solamente un supuesto que evaluar", "green")` 

```{r check assumption}
Lep$diff13_3=Lep$T13-Lep$T3
head(Lep)

library(ggplot2)

ggplot(Lep,aes(diff13_3))+
  geom_histogram()
```

